<html>
<head>
<title>Testing</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://npmcdn.com/simple-statistics@2.0.0/dist/simple-statistics.min.js"></script>
<style>
/* Style information for axis labels */
.axis-label {
    font-family: sans-serif;
    font-size: 12px;
}

/* Style information for axis lines and tick marks */
.axis path,
.axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
}

.axis text {
    font-family: sans-serif;
    font-size: 11px;
}

</style>
</head>
<body>
    <!--
    Select control to set the region to be visualized.  Note that the JavaScript
    callback named "renderVis(...)"" is triggered each time the value for this select
    control changes.
    -->
    <!--
    <p>Select a geographic region:
        <select onchange="renderVis(this.options[this.selectedIndex].value);">
            <option value="United States">United States</option>
            <option value="Midwest">Midwest</option>
            <option value="Northeast">Northeast</option>
            <option value="Other">Other</option>
            <option value="South">South</option>
            <option value="West">West</option>
        </select>
    </p>
-->
    <!--
    This span is used to show "details on demand" when a circle in the scatterplot is moused over.
    -->
    <span id="details">&nbsp;</span><br/>

    <!--
    This span is used to show the computed correlation value for the selected subset of data.
    -->
    <span id="correlation">&nbsp;</span>

    <!--
    This is the container in which D3 will draw the scatter plot.
    -->
    <div id="vis_container">
    </div>

   
    <!--
    Finally, here comes the actual JavaScript code.
    -->
    <script>
        //Bring data in and clean it
        
          var stateFile = "data/state-data.csv";
          console.log(stateFile);
                d3.csv(stateFile,
              function(d) {
                  return {
                      state: d.State,
                      fiscal_year: d.fiscalYear,
                      inflation_denom: d.InflationDenom,
                      Cost_of_living: d.CostOfLiving,
                      expensive_school_enrollment: d.ExpensiveSchoolEnrollment,
                      state_support: d.StateSupport,
                      FT_enrollment: d.FTEnrollment,
                      support_per_student: d.SupportPerStudent
                  };
              },
              function(error, data) {
                  if (error != null) {
                      alert("Uh-oh, something went wrong. Try again?");
                  } else {
                        var filtered_data = data.filter(function(d,i,arr) {
                        if (selectState == d.state) {
                          return d.state;
                        } else {
                          return false;
                        }
                      });
                      plot_data(filtered_data);
                  }
              });
        console.log("Complete");
        // This variable is used to define size of the visualization canvas and the
        // margin (or "padding") around the scatter plot.  We use the margin to draw
        // things like axis labels.
        var height = 500;
        var width = 500;
        var margin = 40;

        // Create the SVG canvas that will be used to render the visualization.
        var svg = d3.select("#vis_container")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Define a variety of scales, for color, x axis and y axis.
        // Poverty rates are all below 30 percent.
        var x = d3.scaleLinear()
            .domain([1998,2016])
            .range([margin,width-margin]);

        // Life expectancy values all fall between 70 and 90.
        var y = d3.scaleLinear()
            .domain([15000,5000])
            .range([margin,height-margin]);

        // There are 4 regions in the continental US, plus "Other" for
        // Hawaii and Alaska.
        var regions = ["Northeast","South","Midwest","West","Other"];
        var region_color = d3.scaleOrdinal(d3.schemeCategory10);

        // Add axes.  First the X axis and label.
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(0,"+(500-margin)+")")
            .call(d3.axisBottom(x));

        svg.append("text")
            .attr("class", "axis-label")
            .attr("y", 495)
            .attr("x",0 + (500 / 2))
            .style("text-anchor", "middle")
            .text("Year");

        // Now the Y axis and label.
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", "translate("+margin+",0)")
            .call(d3.axisLeft(y))

        svg.append("text")
            .attr("transform", "rotate(90)")
            .attr("class", "axis-label")
            .attr("y", -5)
            .attr("x",0 + (500 / 2))
            .style("text-anchor", "middle")
            .text("Avegage funding");

        // Now a clipping plain for the main axes
        // Add the clip path.
        svg.append("clipPath")
            .attr("id", "clip")
            .append("rect")
                  .attr("x", margin)
                  .attr("y", margin)
                  .attr("width", width-2*margin)
                  .attr("height", height-2*margin);

        // Next, we define the renderVis callback.  This is used when the page first loads
        // to draw data for the entire US.  It is also called whenever the select control
        // is changed (e.g., to show only the South or only the Northeast).
        function renderVis(_subset) {
            var data_subset = data;
            if (_subset != "United States") {
                data_subset = data.filter(function(d) {return (d.region == _subset); });
            }

            // Update the correlation score now that we have the requested data subset.
            updateCorrelation(data_subset,_subset);

            // Compute and render the regression line.
            // INLS690: You should add code here.

            // Render the scatterplot.
            var circles = svg.selectAll("circle").data(data_subset, function(d) {return d.state;});

            circles.exit()
                .transition()
                    .duration(250)
                    .attr("r",0)
                    .remove();

            circles.enter().append("circle")
                .attr("r", 0)
                .attr("cx", function(d) { return x(d.poverty_rate); })
                .attr("cy", function(d) { return y(d.life_expectancy); })
                .style("fill", function(d) { return region_color(regions.indexOf(d.region)); })
                .on("mouseover", function(){
                    document.getElementById("details").innerHTML = this.__data__.state + " has a life expectancy of " +
                                                                   this.__data__.life_expectancy + " and a poverty rate of " +
                                                                   this.__data__.poverty_rate + "%.";
                })
                .on("mouseout", function(){ document.getElementById("details").innerHTML = "&nbsp;"; })
                // Animate the radius to have the circles slowly grow to full size.
                .transition()
                    .duration(750)
                    .attr("r",5)
                    // Finally, go back to the enter selection (the circles to which we just added a transition) to
                    // add an svg:title for mouse hovers.
                    .selection().append("svg:title")
                        .text(function(d) { return d.state; });

            // Note: we don't need to deal with the update selection.  WHY?
        }

        // Update the correlation score based on the selected subset.
        function updateCorrelation(data_subset, _region) {
            // INLS690: You should add code here.
        }

        // As the very last step, we make the initial call to renderVis with "us" as the
        // input parameter.  This is because "United States" is the default option for the
        // select control.  We want to default the visualization to show the same thing.
        renderVis("United States");

    </script>
</body>
</html>
